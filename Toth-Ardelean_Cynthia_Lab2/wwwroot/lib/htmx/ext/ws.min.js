!function(){var s;function c(t){t=s.getAttributeValue(t,"hx-ws");if(t)for(var e=t.trim().split(/\s+/),n=0;n<e.length;n++){var r=e[n].split(/:(.+)/);if("connect"===r[0])return r[1]}}function r(t){return null!=s.getInternalData(t).webSocket}function l(t,e){for(;0<t.length;){var n=t[0];if(e.readyState!=e.OPEN)break;e.send(n),t.shift()}}function u(t){var e=htmx.config.wsReconnectDelay;return"function"==typeof e?e(t):"full-jitter"===e?(e=Math.min(t,6),1e3*Math.pow(2,e)*Math.random()):void logError('htmx.config.wsReconnectDelay must either be a function or the string "full-jitter"')}function f(t){return!s.bodyContains(t)&&(s.getInternalData(t).webSocket.close(),!0)}function e(t){return new WebSocket(t,[])}function o(t,e){var n=[];return(s.hasAttribute(t,e)||s.hasAttribute(t,"hx-ws"))&&n.push(t),t.querySelectorAll("["+e+"], [data-"+e+"], [data-hx-ws], [hx-ws]").forEach(function(t){n.push(t)}),n}function a(t,e){if(t)for(var n=0;n<t.length;n++)e(t[n])}htmx.defineExtension("ws",{init:function(t){s=t,null==htmx.createWebSocket&&(htmx.createWebSocket=e),null==htmx.config.wsReconnectDelay&&(htmx.config.wsReconnectDelay="full-jitter")},onEvent:function(t,e){switch(t){case"htmx:beforeCleanupElement":var n=s.getInternalData(e.target);return void(null!=n.webSocket&&n.webSocket.close());case"htmx:afterProcessNode":n=e.target;a(o(n,"ws-connect"),function(t){!function e(a,n){if(!s.bodyContains(a))return;var t=s.getAttributeValue(a,"ws-connect");if(null==t||""===t){var r=c(a);if(null==r)return;t=r}null==n&&(n=0);0==t.indexOf("/")&&(r=location.hostname+(location.port?":"+location.port:""),"https:"==location.protocol?t="wss://"+r+t:"http:"==location.protocol&&(t="ws://"+r+t));var o=htmx.createWebSocket(t);var i=[];o.onopen=function(t){n=0,l(i,o)};o.onclose=function(t){0<=[1006,1012,1013].indexOf(t.code)&&(t=u(n),setTimeout(function(){e(a,n+1)},t))};o.onerror=function(t){s.triggerErrorEvent(a,"htmx:wsError",{error:t,socket:o}),f(a)};o.addEventListener("message",function(t){if(!f(a)){var e=t.data,n=(s.withExtensions(a,function(t){e=t.transformResponse(e,null,a)}),s.makeSettleInfo(a)),t=s.makeFragment(e);if(t.children.length)for(var r=Array.from(t.children),o=0;o<r.length;o++)s.oobSwap(s.getAttributeValue(r[o],"hx-swap-oob")||"true",r[o],n);s.settleImmediately(n.tasks)}});s.getInternalData(a).webSocket=o;s.getInternalData(a).webSocketMessageQueue=i}(t)}),a(o(n,"ws-send"),function(e){var t=s.getAttributeValue(e,"hx-ws");if(!t||"send"===t){var c=s.getClosestMatch(e,r),l=e,n=s.getInternalData(l);let t=s.getTriggerSpecs(l);t.forEach(function(t){s.addTriggerHandler(l,t,n,function(t){var e=s.getInternalData(c).webSocket,n=s.getInternalData(c).webSocketMessageQueue,r=s.getHeaders(l,c),o=s.getInputValues(l,"post"),a=o.errors,o=o.values,i=s.getExpressionVars(l),o=s.mergeObjects(o,i),i=s.filterValues(o,l);i.HEADERS=r,a&&0<a.length?s.triggerEvent(l,"htmx:validation:halted",a):(o=e,r=JSON.stringify(i),a=n,o.readyState!=o.OPEN?a.push(r):o.send(r),s.shouldCancel(t,l)&&t.preventDefault())})})}})}}})}();